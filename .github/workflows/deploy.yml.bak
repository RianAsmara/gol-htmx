name: Deploy

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Docker Compose
      uses: docker/setup-buildx-action@v1

    - name: Login Docker Hub
      uses: docker/login-action@v3
      with:
          username: ${{ vars.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_TOKEN }}

    # - name: Deploy to VPS
    #   env:
    #     SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
    #     VPS_USER: ${{ secrets.VPS_USER }}
    #     VPS_HOST: ${{ secrets.VPS_HOST }}
    #   run: |
    #     echo "${SSH_PRIVATE_KEY}" > private_key
    #     chmod 600 private_key
    #     scp -o StrictHostKeyChecking=no -i private_key docker-compose.yml ${VPS_USER}@${VPS_HOST}:/home/${VPS_USER}/docker-compose.yml
    #     ssh -o StrictHostKeyChecking=no -i private_key ${VPS_USER}@${VPS_HOST} '
    #       docker-compose -f /home/${VPS_USER}/docker-compose.yml pull
    #       docker-compose -f /home/${VPS_USER}/docker-compose.yml up -d
    #     '

    # - name: Apply Database Migrations
    #   run: ./migrate -path ./migrations -database ${{ secrets.DATABASE_URL }} up

    # - name: Slack Notification
    #   uses: 8398a7/action-slack@v3
    #   with:
    #     status: ${{ job.status }}
    #     fields: repo,message,commit,author,action,eventName,ref,workflow,job,took
    #   env:
    #     SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
